<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />
<style type="text/css">html{font-family:sans-serif;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{margin:.67em 0;font-size:2em}mark{color:#000;background:#ff0}small{font-size:80%}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{height:0;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type=checkbox],input[type=radio]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-appearance:textfield}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{padding:.35em .625em .75em;margin:0 2px;border:1px solid silver}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}@media print{*,:after,:before{color:#000!important;text-shadow:none!important;background:0 0!important;-webkit-box-shadow:none!important;box-shadow:none!important}a,a:visited{text-decoration:underline}a[href]:after{content:" (" attr(href) ")"}abbr[title]:after{content:" (" attr(title) ")"}a[href^="javascript:"]:after,a[href^="#"]:after{content:""}blockquote,pre{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}img{max-width:100%!important}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}
  pre:not([class]) {
    background-color: white;
  }
</style>



<title>Lab-04</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>






<style type="text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



</head>

<body>

<div class="container-fluid main-container">







<h1 id="stats-769-lab-04">STATS 769 Lab 04</h1>
<p>The purpose of this lab is to explore parallelisation and optimise operations.</p>
<p>For this lab you have to use one of the <code>fosstatsprd0[2-4]</code> VMs, because of the parallel CPU power needed.</p>
<h2 id="the-data-set">The Data Set</h2>
<p>We will continue to use the NYC taxi trips dataset from Lab 3.</p>
<p>This lab will require considerable processing times so check the load on the VM with <code>uptime</code> or <code>top</code> and consider switching VMs if one gets too busy.</p>
<p>Do <strong>NOT</strong> copy the data files, you can refer to them using absolute paths. When you need to create large output files, use the <code>/course/users/&lt;UPI&gt;</code> directory, do <strong>NOT</strong> use your <code>UNI_HOME</code> for any data files (it is too slow and small for that). It is recommended to create a directory <code>/course/users/&lt;UPI&gt;/lab-4</code>, do all the work there in the shell and command-line R, then save your history and at the end write your report Rmd file from your notes. Once you are happy, you should create the html file from the Rmd on the VMs via <code>Rscript -e &#39;rmarkdown::render(&quot;Lab-04.Rmd&quot;)&#39;</code> or similar.</p>
<h3 id="import">Import</h3>
<ol type="1">
<li><p>We want to focus on the pickup locations and times in the dataset. Given the size of the full data, let us focus on one weekday: 2010-01-08. Write shell code which decompresses and filters the <code>yellow_tripdata_2010-01.csv.bz2</code> dataset such that only records with 2010-01-08 as pickup-date are returned and only values from the columns <code>pickup_datetime</code>, <code>pickup_longitude</code> and <code>pickup_latitude</code>. Save the resulting output into <code>pickup-2010-01-08.txt</code> file, without any header.</p></li>
<li><p>Read the file <code>pickup-2010-01-08.txt</code> into R variable <code>pickup</code> and add the column names such that the result looks like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">   <span class="kw">str</span>(pickup)</a>
<a class="sourceLine" id="cb1-2" title="2">   <span class="st">&#39;data.frame&#39;</span><span class="op">:</span><span class="st"> </span><span class="dv">531514</span> obs. of  <span class="dv">3</span> variables<span class="op">:</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="st">    </span><span class="er">$</span><span class="st"> </span>time<span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;2010-01-08 16:05:00&quot;</span> <span class="st">&quot;2010-01-08 17:15:00&quot;</span> <span class="st">&quot;2010-01-08 22:14:00&quot;</span> <span class="st">&quot;2010-01-08 22:26:00&quot;</span> ...</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="op">$</span><span class="st"> </span>lon <span class="op">:</span><span class="st"> </span>num  <span class="dv">-74</span> <span class="fl">-73.8</span> <span class="dv">-74</span> <span class="dv">-74</span> <span class="dv">-74</span> ...</a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="op">$</span><span class="st"> </span>lat <span class="op">:</span><span class="st"> </span>num  <span class="fl">40.8</span> <span class="fl">40.7</span> <span class="fl">40.7</span> <span class="fl">40.8</span> <span class="fl">40.7</span> ...</a></code></pre></div>
<p>Verify that you really have only records for the day 2010-01-08.</p>
<p>Plot the locations in the dataset. Are there any suspicious values?</p></li>
<li><p>We want to remove all points outside the New York City area. Remove from <code>pickup</code> all points that are not within 40.4 and 41.1 degrees latitude, -74.5 and -73.5 degrees longitude. In the following you donâ€™t need to consider anything outside that area.</p>
<p>Split the <code>pickup</code> dataset into 24 pieces, one for each hour and store the result in a variable <code>by_hour</code>. That is, the first element has data from midnight (inclusive) to 01:00 (exclusive), the second from 01:00 to 02:00 etc.</p>
<p>Count the number of trips in each hour and show it in a plot. Comment on the plot.</p></li>
<li><p>For each pickup location we want to find the closest Foursquare check-in location from the <code>/course/data/fsquare/dataset_TIST2015_POIs.txt</code> dataset used in the lecture. Read the dataset into the variable <code>fs</code> and adjust the column names to obtain the following result:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">   <span class="kw">str</span>(fs)</a>
<a class="sourceLine" id="cb2-2" title="2">   <span class="st">&#39;data.frame&#39;</span><span class="op">:</span><span class="st"> </span><span class="dv">3680126</span> obs. of  <span class="dv">5</span> variables<span class="op">:</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">    </span><span class="er">$</span><span class="st"> </span>id     <span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;3fd66200f964a52000e71ee3&quot;</span> <span class="st">&quot;3fd66200f964a52000e81ee3&quot;</span> <span class="st">&quot;3fd66200f964a52000ea1ee3&quot;</span> <span class="st">&quot;3fd66200f964a52000ec1ee3&quot;</span> ...</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="op">$</span><span class="st"> </span>lat    <span class="op">:</span><span class="st"> </span>num  <span class="fl">40.7</span> <span class="fl">40.8</span> <span class="fl">40.7</span> <span class="fl">42.3</span> <span class="fl">39.9</span> ...</a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="op">$</span><span class="st"> </span>lon    <span class="op">:</span><span class="st"> </span>num  <span class="dv">-74</span> <span class="dv">-74</span> <span class="dv">-74</span> <span class="fl">-71.1</span> <span class="fl">-75.2</span> ...</a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="op">$</span><span class="st"> </span>type   <span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;Jazz Club&quot;</span> <span class="st">&quot;Gym&quot;</span> <span class="st">&quot;Indian Restaurant&quot;</span> <span class="st">&quot;Indian Restaurant&quot;</span> ...</a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="op">$</span><span class="st"> </span>country<span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;US&quot;</span> <span class="st">&quot;US&quot;</span> <span class="st">&quot;US&quot;</span> <span class="st">&quot;US&quot;</span> ...</a></code></pre></div>
<p>Let us focus on the subset of pickups between 08:00 and 09:00. Write R code which finds the closest Foursquare location (as row number in <code>fs</code>) for each pickup location. You should develop your code on a small subset first. Then parallelise the code using <code>mclapply</code> with 10 cores. Measure the time of your final run. (Ideally, it should be possible to run your code within a minute on the VM.)</p></li>
<li><p>Perform the same task as in the previous question, but instead of <code>mclapply</code> use <code>makeCluster(10)</code> and corresponding cluster functions such as <code>clusterApply</code> and <code>clusterExport</code>. Measure the total time (from <code>makeCluster</code> to <code>stopCluster</code>) and compare the result with the <code>mclapply</code> approach - both with respect to the timings and complexity.</p></li>
<li><p>Run the same analysis (based on either code from question 4. or 5. - your choice), but for the time between 20:00 and 21:00 instead. Based on this result and the previous result, compute the tables of the Forsquare venue <code>type</code> nearest the pickup locations between 08:00-09:00 and between 20:00-21:00 hours. Compare the two tables and comment on the results.</p></li>
</ol>
<h1 id="the-report">The Report</h1>
<p>Your submission should consist of an R Markdown document, submitted via Canvas. You should write your document so that it can be processed on a computer without any manual intervention. For example, do not include any calls to <code>setwd()</code> or <code>file.choose()</code>. You should write code that assumes that data files are at a fixed location in <code>/course/data/</code> on the VMs. Also submit a processed version of your R Markdown document (an HTML document) in case we cannot process your document on the VM.</p>
<p>Your report should include:</p>
<ul>
<li>A brief description of the data.</li>
<li>For each task, shell/R code AND a brief text commentary.</li>
</ul>
<h1 id="marking">Marking</h1>
<p>Marks will be lost for:</p>
<ul>
<li>R Markdown file is missing.</li>
<li>R Markdown file does not run.</li>
<li>Processed file (HTML) is missing.</li>
<li>Section of the report is missing.</li>
<li>Unintelligible, or confusing, or irrelevant summary.</li>
<li>Significantly poor R (or other) code.</li>
<li>Overly verbose code, output, or commentary.</li>
</ul>



<!-- code folding -->



<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://stat.auckland.ac.nz/~urbanek/mj/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</div>
</body>
</html>
