<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />
<style type="text/css">html{font-family:sans-serif;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{margin:.67em 0;font-size:2em}mark{color:#000;background:#ff0}small{font-size:80%}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{height:0;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type=checkbox],input[type=radio]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-appearance:textfield}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{padding:.35em .625em .75em;margin:0 2px;border:1px solid silver}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}@media print{*,:after,:before{color:#000!important;text-shadow:none!important;background:0 0!important;-webkit-box-shadow:none!important;box-shadow:none!important}a,a:visited{text-decoration:underline}a[href]:after{content:" (" attr(href) ")"}abbr[title]:after{content:" (" attr(title) ")"}a[href^="javascript:"]:after,a[href^="#"]:after{content:""}blockquote,pre{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}img{max-width:100%!important}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}
  pre:not([class]) {
    background-color: white;
  }
</style>



<title>Lab-05</title>









<style type="text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



</head>

<body>

<div class="container-fluid main-container">







<h1 id="stats-769-lab-05">STATS 769 Lab 05</h1>
<p>The purpose of this lab is to explore distributed computing.</p>
<p>For this lab you have to use one of the
<code>fosstatsprd0[2-4]</code> VMs, because you will need access to the
Hadoop cluster. You can use <code>eval=FALSE</code> for most questions
and paste the output from the VM instead (as text, not
screenshots!).</p>
<p><strong>Very important: when working on the Hadoop cluster, please
maintain proper cluster hygiene described in the last section of the
lab!</strong> You will be sharing a cluster with all other students, so
<strong>do not leave the lab at the last minute</strong> since the
cluster may be overloaded shortly before submission deadline if you do.
As part of the class you have to learn to use shared resources, so
congestion of the cluster at a given time is not an excuse nor reason
for an extension. If you start too late, you will be expected to solve
the lab without testing your code.</p>
<h2 id="the-data-set">The Data Set</h2>
<p>We will continue to use the NYC taxi trips dataset from Lab 3 and the
Airline dataset from the lectures.</p>
<p>Do <strong>NOT</strong> copy the data files, you can refer to them
using absolute paths. It this lab, there should be no large output
files, so you can work in your <code>UNI_HOME</code> if you desire and
you can render the final html on your local machine since no code will
be actually run.</p>
<h3 id="tasks">Tasks</h3>
<ol type="1">
<li><p>We want to replicate the model from Lab 3 using chunk-wise
processing. We want to model <code>tip_amount</code> based on
<code>pre_tip</code> (total amount minus tip) for the trips paid by
credit card. However, instead of a random split, we will use the last
fours days as test set and all preceding days as training set (based on
<code>pickup_datetime</code>). Write R script to fit the model by
processing <code>yellow_tripdata_2010-01.csv.bz2</code> chunk-wise with
<code>iotools::chunk.reader</code> and the <code>biglm</code> package.
For each chunk print the summary of the fitted model and run
<code>gc()</code> to minimise memory footprint (include only the last
iteration in the report). Compare the resulting model with the model
obtained in question 8 of Lab 3 (if you didn’t answer that question in
Lab 3, compare with the model solution).</p>
<p>Print the output of <code>gc()</code> after the model fitting. This
is the output after model fitting using the Lab 3 question 8 model
solution (entirely in-memory):</p>
<pre><code>            used  (Mb) gc trigger   (Mb)  max used   (Mb)
Ncells    287396  15.4     665674   35.6    424141   22.7
Vcells 129454654 987.7  185244383 1413.4 150994989 1152.1</code></pre>
<p>Compare it to the memory usage in your chunk-wise solution and
discuss the trade-offs between the two approaches.</p>
<p>Write R code to compute the root mean squared error (RMSE) based on
the test set also using chunk-wise processing and print the
result.</p></li>
<li><p>The data for the NYC taxi dataset for year 2010 in Parquet format
is in HDFS on the cluster at the path
<code>/data/nyctaxi/yellow/2010</code>. For this question write R code
using SparkR as follows. Extract the data with pick-up date 2010-01-08
and splits the resulting dataset randomly 90%/10% into training and test
set. Then compute the same model as in previous question (fit a linear
model with <code>tip_amount</code> as response and <code>pre_tip</code>
as predictor based on transactions made with a credit card) on the
training set, print the coefficients of the model and compare it with
the result from the previous question. (NOTE: use <code>sparkR</code> on
the cluster, you cannot run this code in RMarkdown).</p>
<p>Finally, use the model to predict values for the 10% test set,
compute the root mean square error (RMSE) and print it.</p></li>
<li><p>There is a Hive table <code>flights</code> in the database
<code>airline</code> in the cluster corresponding to the “ASA Data Expo
2009 airline on time” dataset as used in the second lecture.</p>
<p>Write a Hive query to return the airport code, mean arrival delay and
the number of flights for the top 5 airports with the highest mean
arrival delay. Include both the Hive SQL query and the output (just the
relevant data part, not the logs).</p>
<p>Note: you can use
<code>beeline -u jdbc:hive2://fosstatsprd01:10000</code> to connect to
Hive from any of the VMs.</p></li>
<li><p>Write a Map/Reduce job using R and the <code>hmapred</code>
package to compute the mean arrival delay for all pairs of
origin/destination airports from the airline dataset (in HDFS at
<code>/data/airline/csv</code>). Read the result into R and print the
top 5 pairs.</p></li>
</ol>
<h1 id="the-report">The Report</h1>
<p>Your submission should consist of an R Markdown document, submitted
via Canvas. All code in this document should be be run on the VM and the
corresponding code and output pasted into the document into chunks with
<code>eval=FALSE</code> or plain markdown chunks for output (i.e., just
three backticks without the specification of a language). Also submit a
processed version of your R Markdown document (an HTML document) in case
we cannot process your document on the VM.</p>
<p>Your report should include:</p>
<ul>
<li>For each task, shell/R code AND a brief text commentary.</li>
</ul>
<h1 id="marking">Marking</h1>
<p>Marks will be lost for:</p>
<ul>
<li>R Markdown file is missing.</li>
<li>R Markdown file does not run.</li>
<li>Processed file (HTML) is missing.</li>
<li>Section of the report is missing.</li>
<li>Significantly poor R (or other) code.</li>
<li>Overly verbose code, output, or commentary.</li>
</ul>
<h1 id="cluster-hygiene">Cluster Hygiene</h1>
<p>When working on shared resources you must be make sure that you are
not unnecessarily exhausting resources or blocking other users. This
means you should always monitor your jobs and be ready to kill them
(e.g. using <code>mapred job -kill</code> or
<code>yarn app -kill</code>) if they get out of hand. Also you should
not leave SparkR console open for excessive time, because as long as the
console is active it is reserving resources on the cluster. Always make
sure you log out when you are done. When running jobs, check the usage
on the cluster using <code>yarn top</code>. Note that administrators
reserve the right to kill processes and applications that are negatively
affecting the cluster, so always save your scripts, don’t rely on the
interactive sessions to survive.</p>



<!-- code folding -->



<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://stat.auckland.ac.nz/~urbanek/mj/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</div>
</body>
</html>
